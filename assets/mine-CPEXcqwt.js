import{o as e}from"./chunk-B4c1uyq5.js";import{_ as t,h as n,n as r,r as i,t as a}from"./emotion-react-jsx-runtime.browser.esm-Dyzc9xaG.js";import"./styles-_XN5nLf0.js";import{t as o}from"./classnames-B5nd86Bh.js";import{n as s,t as c}from"./createRegion-0mA6f8t6.js";import"./_MapCache-cQY-gewi.js";import{t as l}from"./_baseIteratee-BdkN-utd.js";import"./_cacheHas-BBfXsIJl.js";import"./_Uint8Array-DxmO6gPW.js";import"./_getTag-Bo9PnLBx.js";import{t as u}from"./compact-wm0Z47iR.js";function ee(e,t){for(var n,r=-1,i=e.length;++r<i;){var a=t(e[r]);a!==void 0&&(n=n===void 0?a:n+a)}return n}var te=ee;function d(e,t){return e&&e.length?te(e,l(t,2)):0}var f=d,ne=n(),p=t();const m=window.innerWidth,h=window.innerHeight,g=Math.floor(m/20),_=Math.floor(h*.95/g),v=20*_,y=Math.floor(v*.2),b={width:20*g,height:_*g},x={width:g,height:g},re={width:g*3,height:g*3},S=[];for(let e=0;e<_;e++)for(let t=0;t<20;t++)S.push({x:t,y:e});const ie=e=>{e.mark=!0},C=e=>{if(e.reveal)return;if(e.reveal=!0,e.mine)throw e.mark=!0,Error(`失败`);let{label:t}=e;t===0&&M(e).forEach(C)},w=e=>{let{mark:t,reveal:n}=e;t&&t.forEach(ie),n&&n.forEach(C)},T=e=>({mark:u(e.map(e=>e.mark)).flat(),reveal:u(e.map(e=>e.reveal)).flat()});var ae=e=>e.reveal&&e.mine||!e.reveal?1:0;const E=e=>{if(e.mine)return{};let t=M(e);return f(t,ae)===e.label?{mark:t.filter(e=>!e.reveal)}:f(t,e=>e.mark?1:0)===e.label?{reveal:t.filter(e=>!e.mark)}:{}};var D=s();const O=D.getValue,k=D.useValue,A=D.set,j=()=>u(S.map(O)),M=e=>{let{x:t,y:n}=e;return u([O({x:t-1,y:n-1}),O({x:t-1,y:n}),O({x:t-1,y:n+1}),O({x:t,y:n-1}),O({x:t,y:n+1}),O({x:t+1,y:n-1}),O({x:t+1,y:n}),O({x:t+1,y:n+1})])};S.forEach(({x:e,y:t})=>{A({x:e,y:t},{x:e,y:t,mine:!1,reveal:!1,mark:!1,label:0})});var N=c(0);const P=()=>N.set(e=>e+1),F=N.useValue;var I=e(o(),1),L={block:`_block_16us8_1`},R={cover:`_cover_1hi80_1`,reveal:`_reveal_1hi80_6`,mine:`_mine_1hi80_11`,mark:`_mark_1hi80_15`,label0:`_label0_1hi80_19`,label1:`_label1_1hi80_23`,label2:`_label2_1hi80_27`,label3:`_label3_1hi80_31`,label4:`_label4_1hi80_35`,label5:`_label5_1hi80_39`,label6:`_label6_1hi80_43`,label7:`_label7_1hi80_43`,label8:`_label8_1hi80_43`},z=({coordinate:e})=>{let t=k(e);if(!t)return null;let{mine:n,reveal:i,mark:a,label:o}=t;return i?r(`div`,{className:(0,I.default)(L.block,R.reveal,{[R[`label${o}`]]:!n,[R.mine]:n}),style:x,children:n?`!`:o}):r(`div`,{className:(0,I.default)(L.block,R.cover,{[R.mark]:a}),style:x,children:a&&`m`})},B={content:`_content_1mign_1`,panel:`_panel_1mign_11`,header:`_header_1mign_17`},V=!1;const H=()=>{j().forEach(e=>{e.reveal=!1,e.mark=!1}),V=!1,P()};H();var U=()=>{j().forEach(e=>{e.mine=!1});let e=0;for(;e<y;){let t=O({x:Math.floor(Math.random()*20),y:Math.floor(Math.random()*_)});t.mine||(t.mine=!0,e++)}j().forEach(e=>{e.label=f(M(e),`mine`)})},W=e=>{for(let t=0;t<100;t++)if(U(),!e.mine&&e.label===0)return},G=e=>{w(E(e))};const K=e=>{let t=O(e);if(!t||t.mark)return;V||=(W(t),!0);let{reveal:n}=t;n||C(t),G(t),w(T(M(t).filter(e=>e.reveal).map(E)))},q=e=>{try{K(e)}catch(e){console.error(e)}finally{P()}};var J=c();const oe=J.useValue;var Y=e=>{J.set(t=>!t||t.x!==e.x||t.y!==e.y?e:t)},X=J.reset,Z=(e,t,n)=>{let r=e.getBoundingClientRect(),i=t-r.left+e.scrollLeft,a=n-r.top+e.scrollTop;return{x:Math.floor(i/g),y:Math.floor(a/g)}},Q=e=>t=>{t.preventDefault();let n=t.changedTouches[0].clientX,r=t.changedTouches[0].clientY;e({clientX:n,clientY:r})},$=(e,t)=>n=>{let r=n.clientX,i=n.clientY;t&&!n.buttons||e({clientX:r,clientY:i})},se=e=>((0,p.useEffect)(()=>{let t=e.current;if(!t)return;let n=({clientX:e,clientY:n})=>{Y(Z(t,e,n))},r=Q(n),i=$(n),a=({clientX:e,clientY:n})=>{let r=Z(t,e,n);Y(r),q(r)},o=Q(a),s=$(a,!0),c=({clientX:e,clientY:n})=>{q(Z(t,e,n)),X()},l=Q(c),u=$(c);return document.body.addEventListener(`touchstart`,r),document.body.addEventListener(`mousedown`,i),document.body.addEventListener(`touchmove`,o,{passive:!1}),document.body.addEventListener(`mousemove`,s),document.body.addEventListener(`touchend`,l),document.body.addEventListener(`mouseup`,u),()=>{document.body.removeEventListener(`touchstart`,r),document.body.removeEventListener(`mousedown`,i),document.body.removeEventListener(`touchmove`,o),document.body.removeEventListener(`mousemove`,s),document.body.removeEventListener(`touchend`,l),document.body.removeEventListener(`mouseup`,u)}},[e]),e),ce={castRange:`_castRange_17m5f_1`};function le(){let e=oe();if(!e)return null;let{x:t,y:n}=e;return r(`div`,{className:ce.castRange,style:{...re,left:(t-1)*g,top:(n-1)*g}})}var ue=(0,p.memo)(le);(0,ne.createRoot)(document.body).render(r(()=>{F();let e=(0,p.useRef)(null);se(e);let t=j();return i(a,{children:[r(`div`,{className:B.header,onMouseUp:H,onTouchEnd:H,children:t.filter(e=>e.mine&&!e.mark).length}),r(`div`,{className:B.content,children:i(`div`,{className:B.panel,style:b,ref:e,children:[S.map(e=>r(z,{coordinate:e},`${e.x}-${e.y}`)),r(ue,{})]})})]})},{}));